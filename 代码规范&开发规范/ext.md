# Ext

## 1  extjs - 基于ExtJS的开发

### 1.1 global - 全局变量

基于OnePage(单页面模式)的开发（如AC的框架），除框架级JS代码，各组件不允许出现全局变量(命名空间除外)，包括使用不当创建出来的（例如var a = b = c，b和c未使用var声明）。

对于多页面的开发模式（如ssl）,允许使用全局变量，但全局变量必须统一放在代码最前面方便管理。

> 原因：单页面开发模式，所有页面的变量都是共享的，写太多全局变量容易造成冲突，或资源无法释放。而多页面开发，每个页面的环境都是单一的，只要把全局变量都放在文件顶部，方便统一管理即可。

各函数内的变量声明(var)统一放置在最根层，不允许在代码块中声明（如if、for、while中）。

> 原因：JS在函数执行前统一处理函数体内代码中的所有变量声明，不管它在哪。包括带标识的函数声明：function Fun(){...}。

不允许将变量挂在window上。

> 原因：将变量挂到window上，则变成全局变量，不仅容易给污染还对他人代码有侵入性，带来的问题难以排查。

### 1.2 id - 固定id

禁止可复用组件使用固定id。

> 原因：使用固定ID会让组件脱离componentMgr的管理，导致无法预期的错误，甚至内存泄漏。

### 1.3 htmlEncode - 实体编码

* XTemplate中，字符串的回显，需要进行编码；
* gridpanel的列配置中，renderer不能留空，默认进行htmlEncode；

> 原因：外部数据都是不可信的，前端应该保证尽量不给脚本注入任何机会。

### 1.4 item - 子组件获取

* 禁止使用items.items[0]的获取方式；
* 禁用对子组件使用固定ID，需用itemId替换，通过p.getComponent(itemId)访问；

> 原因：使用固定id容易让代码变得难以维护，且容易出问题。

### 1.5 prop - 属性获取

组件属性可以修改的，需要通过a.getXXX()和a.setXXX(yyy)来获取和修改，不能通过a.XXX直接修改。

> 原因：违背OOP原则，数据修改行为应限制在对象内。

### 1.6 destroy - 组件销毁

new出来的组件，都必须要进行 销毁，不管是否add到容器中。

> 原因：new了以后就会在Ext.ComponentMgr中注册对象，需destroy后才会清理，不destroy会有内存泄漏。

### 1.7 cmpcfg - 组件配置

子组件的配置，尽量以json配置方式存在于Items中，而不要先new出来。

> 原因：一是对性能有影响，二是容易遗漏造成内存泄漏。

### 1.8 render - 组件渲染

对于dom节点频繁更新的（比如grid的column），不能将实例化后组件渲染到上面。

> 原因：dom节点直接擦除(update)后，组件实例的el引用的dom会变成孤立节点（没有父节点），容易出现脚本错误且造成内存泄漏。

### 1.9 ownerCt - ownerCt使用

禁止在代码中使用1个以上的owerCt调用。如field.ownerCt.ownerCt.hide();。

> 原因：子组件调用父组件的接口，相当于是儿子管老爸（甚至是爷爷）做事，职责不清晰，表明代码需要优化。